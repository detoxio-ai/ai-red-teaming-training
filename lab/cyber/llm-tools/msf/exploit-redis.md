# ğŸ” Exploiting Redis CVE-2022-0543 Using Metasploit & LLM Tools

> This tutorial demonstrates how to **detect and verify** a Redis vulnerability (CVE-2022-0543) using **Nmap**, **Metasploit**, and a custom-built **LLM tool plugin**.

---

## ğŸ§° Prerequisites

Ensure you have the following:

* ğŸ§ A Linux VM (e.g., Ubuntu)
* âœ… Docker + Docker Compose
* âœ… Metasploit installed (`msfconsole`)
* âœ… `nmap` installed
* âœ… Python â‰¥ 3.10
* âœ… [`llm`](https://github.com/llm-tools/llm) installed
* âœ… `llm-tools-msf.py` with the following registered methods:

  * `find_metasploit_modules_for_service`
  * `check_vulnerability_with_metasploit`

---

## ğŸ“¦ Step 1: Start the Vulnerable Redis Target

We will use the `vulhub` environment to spin up a Redis instance vulnerable to CVE-2022-0543.

```bash
cd $HOME/labs/vulhub/redis/CVE-2022-0543
docker compose up -d
```

âœ… This exposes Redis on `localhost:6379`.

---

## ğŸ” Step 2: Verify Redis Is Running

Run this to make sure Redis is listening:

```bash
sudo netstat -tuln | grep 6379
# OR
ss -tuln | grep 6379
```

Expected output:

```
tcp   LISTEN  0  128  0.0.0.0:6379  0.0.0.0:*
```

---

## ğŸ¤– Step 3: Use LLM to Search for Metasploit Modules

Now, use the LLM tool to scan the Redis service and search related Metasploit modules:

```bash
cd $HOME/labs/ai-red-teaming-training/lab/cyber/llm-tools/msf/
llm --model gpt-4o --functions llm-tools-msf.py \
"search metasploit module to exploit a vulnerability on 127.0.0.1 redis port"
```

âœ… Output should include modules like:

* `exploit/linux/redis/redis_debian_sandbox_escape`
* `exploit/linux/redis/redis_replication_cmd_exec`

---

## âœ… Step 4: Check Vulnerability Using Metasploit Module

Use the LLM again to **run the module in safe `check` mode** (no reverse shell, just vulnerability check):

```bash
llm --model gpt-4o --functions llm-tools-msf.py \
"check metasploit module exploit/linux/redis/redis_debian_sandbox_escape on 127.0.0.1 redis service"
```

âœ… Expected output:

```
The Metasploit module exploit/linux/redis/redis_debian_sandbox_escape indicates that the Redis service is vulnerable.
The module successfully executed the 'id' command on the target.
```

---

## ğŸ’¥ \[Optional] Run the Exploit (for Demonstration Only)

If you're authorized to do so, you can modify the LLM tool to **run the module** (e.g., with payload), but it's best practice to **only run `check`** in red-teaming demos unless exploitation is explicitly allowed.

---

## ğŸ§  Bonus: Understand CVE-2022-0543

* A **Lua sandbox escape** vulnerability in Redis **on Debian-based systems**
* Lets attackers **execute arbitrary system commands**
* Metasploit module: `exploit/linux/redis/redis_debian_sandbox_escape`
* Requires no authentication in default config

More: [https://nvd.nist.gov/vuln/detail/CVE-2022-0543](https://nvd.nist.gov/vuln/detail/CVE-2022-0543)

---

## ğŸ§¹ Step 5: Cleanup

When done:

```bash
cd $HOME/labs/vulhub/redis/CVE-2022-0543
docker compose down
```

---

## ğŸ§ª Troubleshooting

* âŒ **No Redis detected**? Try `127.0.0.1` instead of `localhost`
* âŒ **Ports not open**? Ensure Docker container is running and port 6379 is bound to the host
* âŒ **LLM hangs**? Make sure `msfconsole` works standalone and doesnâ€™t prompt for DB setup
* âŒ **Timeouts?** Add logging or test commands manually in shell for debugging

---

## âœ… Success!

Youâ€™ve now:

* Deployed a vulnerable Redis service
* Scanned with Nmap
* Identified matching Metasploit modules
* Verified CVE-2022-0543 using Metasploit safely via LLM tools

